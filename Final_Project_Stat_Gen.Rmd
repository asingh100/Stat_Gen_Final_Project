---
title: "Final Project"
output: pdf_document
---

```{r setup, include=FALSE}
library(TCGAbiolinks)
library(tidyverse)
library(SummarizedExperiment)
library(DescTools)
```


## Data Download, Cleaning, and Processing:

```{r}
query_meth.hg19 <- GDCquery(project= "TCGA-KIRC",
                            data.category = "DNA methylation",
                            platform = "Illumina Human Methylation 450",
                            legacy = TRUE)
GDCdownload(query_meth.hg19)
data.hg19 <- GDCprepare(query_meth.hg19)

meth_data = data.frame(assay(data.hg19))

sample = data.frame(data.hg19$sample_type,data.hg19$barcode)

colnames(sample) = c("Group","Sample_ID")

sample$Group = recode(sample$Group, "Additional - New Primary" = "Primary Tumor")

Case = filter(sample, Group == "Primary Tumor")

Case$Sample_ID = gsub("-",".",Case$Sample_ID)

Control = filter(sample, Group == "Solid Tissue Normal")

Control$Sample_ID = gsub("-",".",Control$Sample_ID)

Case_Meth_Data = dplyr::select(meth_data,tidyselect::contains(Case$Sample_ID))

Control_Meth_Data = dplyr::select(meth_data,tidyselect::contains(Control$Sample_ID))

Case_Meth_Data = data.frame(t(Case_Meth_Data))

Control_Meth_Data = data.frame(t(Control_Meth_Data))

Case_Meth_Data = Case_Meth_Data[, colSums(is.na(Case_Meth_Data)) != nrow(Case_Meth_Data)]

Control_Meth_Data = Control_Meth_Data[, colSums(is.na(Control_Meth_Data)) != nrow(Control_Meth_Data)]

table(colnames(Case_Meth_Data)==colnames(Control_Meth_Data)) #check if CpG sites are same
```

## Two Sample T-Tests:

```{r}
#Two Sample T tests for Cases and Controls for Each CpG Site:

t_test_res = data.frame()

for (j in seq(1,ncol(Case_Meth_Data))){
    t_test_res_temp = t.test(Case_Meth_Data[[j]],Control_Meth_Data[[j]],alternative="two.sided")%>%
      broom::tidy()
    t_test_res = rbind(t_test_res,t_test_res_temp) 
}

t_test_res$CpG_Site = colnames(Case_Meth_Data)

t_test_res = dplyr::select(t_test_res,c("CpG_Site","p.value"))

## FDR Correction:

t_test_res_FDR = t_test_res%>%
  mutate(FDR_P_Value = p.adjust())
```

## Logistic Regression:

```{r}

```

## Results:

```{r}

```

## Discussion and Conclusions:
